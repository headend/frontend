{% extends 'base.html' %}
{% block content %}
<!-- <script type="text/javascript" src="/static/homepage/js/angular.min.js"></script>
 -->
<div class="app-title">
<div>
  <h1><i class="fa fa-th-list"></i><a href="/agents/"> Server</a></h1>
  
</div>
<ul class="app-breadcrumb breadcrumb side">
  <li class="breadcrumb-item"><a href="/"><i class="fa fa-home fa-lg"></i></a></li>
  <li class="breadcrumb-item">Server</li>
  <li class="breadcrumb-item active"><a href="/agents/">Server</a></li>
</ul>
</div>

<div class="row">
  <div class="col-md-12">
    <div class="tile">
      <form class="row" id="frmreport" name="frmreport" method="POST">
        <div class="form-group col-md-3">
          <select class="form-control" id="versionServer" name="versionServer">
            {% for ver in data.versions %}
            <option selected value="{{ ver }}">{{ ver }}</option>
            {% endfor %}
            <option selected value="">---Choose version---</option>
          </select>
        </div>

        <div class="form-group col-md-3">
            <select class="form-control" id="statusServer" name="statusServer">
              {% for state in data.states %}
                <option selected value="{{ state.id }}">{{ state.name }} - {{ state.desc }}</option>
              {% endfor %}
                <option selected value="">---Choose status---</option>
            </select>
        </div>
            
        <div class="form-group col-md-3 align-self-end">
            <button class="btn btn-sm btn-primary" type="button" onclick="serverSearch()"><i class="fa fa-fw fa-lg fa-check-circle"></i>Search</button>
        </div>
    
        <div class="form-group col-md-3 align-self-end">
            <button class="btn btn-sm btn-primary" type="button" onclick="reportlevelexport()"><i class="fa fa-fw fa-lg fa-check-circle"></i>Export</button>
        </div>
      </form>
    </div> <!-- End title -->
  </div>

  <div class="clearix"></div>
  <div class="col-md-12">
    <div class="tile">
      <div class="tile-body">
        <table class="table table-hover table-bordered" id="dataTable">
          <thead>
            <tr>
              <th>SID</th>
              <th>Name</th>
              <th>Host</th>
              <th>Port</th>
              <th>Status</th>
              <th>Open Date</th>
              <th>Time has opened</th>
              <th>Client</th>
              <th>Control</th>
              <th>Register</th>
            </tr>
          </thead>
          <tbody>

              {% for sid in data.servers %}
              <tr>
                  <td>{{ sid.sid }}</td>
                  <td>{{ sid.name }}</td>
                  <td>{{ sid.host }}</td>
                  <td>{{ sid.port }}</td>
                  <td>
                    <select class="form-control" id="select_state{{ sid.sid }}" name="{{ sid.sid }}" onchange="changeState(this);">
                    {% for state in data.states %}
                      {% if state.id == sid.status %}
                        <option selected value="{{ state.id }}">{{ state.name }} - {{ state.desc }}</option>
                      {% else %}
                        <option value="{{ state.id }}">{{ state.name }} - {{ state.desc }}</option>
                      {% endif %}
                    {% endfor %}
            </select>
                  </td>
                  <td>{{ sid.timestamps.open }}</td>
                  <td>{{ sid.timestamps.time_has_opened }}</td>
                  <td>{{ sid.client_version }}</td>
                  <td>
                    <button id="{{ sid.sid }}" name="start_{{sid.host}}" type="button" class="btn btn-sm btn-primary" onclick="serverControl(this)">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                      <span><strong>Start</strong></span> 
                    </button>
                    <button id="{{ sid.sid }}" name="restart_{{sid.host}}" type="button" class="btn btn-sm btn-warning" onclick="serverControl(this)">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                      <span><strong>Restart</strong></span> 
                    </button>

                    <button id="{{ sid.sid }}" name="stop_{{sid.host}}" type="button" class="btn btn-sm btn-danger" onclick="serverControl(this)">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                      <span><strong>Stop</strong></span> 
                    </button>
                  </td>
                  <td>
                    {% if sid.status != 1 %}
                    <button id="{{ sid.sid }}" name="allow" type="button" class="btn btn-sm btn-primary" onclick="serverControlRegister(this)">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                      <span><strong>Allow</strong></span> 
                    </button>

                    <button id="{{ sid.sid }}" name="deny" type="button" class="btn btn-sm btn-warning" onclick="serverControlRegister(this)">
                      <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                      <span><strong>Deny</strong></span> 
                    </button>
                    {% endif %}
                  </td>
              </tr>
              {% endfor %}      
            
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div> <!-- end row  -->

{% endblock %}